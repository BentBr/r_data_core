# r_data_core - Master Data Management Service

## Project Overview
r_data_core is a Rust-based MDM (Master Data Management) service that provides custom entity definition capabilities. It allows users to create custom entities (like users, customers, products, categories) that can be queried and managed through automatically generated REST endpoints.

## Core Concepts

### Entities
- Custom objects that users can create and define
- Examples: users, customers, products, categories, technical objects
- Have standard fields (uuid, creator_id, created_at, updated_at, etc.)
- Custom fields, validation, and definitions are set via the Class Definition API
- Support dynamic schema evolution

### Class Definitions
- Define the structure and validation rules for entities
- Specify field types, constraints, and UI configurations
- Support complex field types and relationships
- Managed through the admin API

## API Architecture

### Public API (`/api/docs/`)
- **Authentication**: JWT token (from admin login) or API key
- **Purpose**: Access to all entity types created via class definitions
- **Features**: 
  - Full CRUD operations
  - Advanced filtering and pagination
  - Dynamic entity creation and management
  - Query capabilities with complex filters

### Admin API (`/admin/api/docs/`)
- **Authentication**: Admin JWT authentication only
- **Purpose**: System administration and configuration
- **Features**:
  - Admin user management
  - Class definition creation and management
  - API key management
  - System configuration
  - Permissions and workflows

## Technology Stack

### Backend
- **Language**: Rust
- **Framework**: Actix-web
- **Database**: PostgreSQL with advanced features
- **Caching**: Redis
- **Authentication**: JWT-based
- **API Documentation**: OpenAPI/Swagger

### Development & Deployment
- **Containerization**: Docker & Docker Compose
- **Target**: Kubernetes-ready container images
- **Database**: PostgreSQL with migrations
- **Cache**: Redis for performance optimization

## Project Structure

### Key Directories
- `src/api/` - API endpoints and routing
- `src/entity/` - Core entity and class definition logic
- `src/services/` - Business logic and service layer
- `src/db/` - Database operations and repositories
- `tests/` - Integration and unit tests
- `migrations/` - Database schema migrations

### Important Modules
- `entity/dynamic_entity/` - Dynamic entity implementation
- `entity/class/` - Class definition system
- `api/admin/` - Administrative endpoints
- `api/public/` - Public entity endpoints
- `services/` - Business logic services

## Development Guidelines

### Code Quality
- Always run `cargo fmt` after changes
- Follow strict `cargo clippy` standards
- Maintain comprehensive test coverage
- Use proper error handling and logging

### Testing Strategy
- **Unit Tests**: Run with `rdt test-unit` (can run in parallel)
- **Integration Tests**: Run with `rdt test` (sequential execution)
- **Test Location**: `/tests/` directory
- **Test Coverage**: Aim for comprehensive coverage of all modules
- Never run `cargo test` as this will have failing tests

### Database
- Use migrations for schema changes
- Follow naming conventions
- Implement proper indexing strategies
- Handle database connections efficiently

## Current Status

### Implemented Features
- âœ… Dynamic entity system
- âœ… Class definition API
- âœ… Authentication (JWT + API keys)
- âœ… CRUD operations
- âœ… Advanced filtering and pagination
- âœ… Admin user management
- âœ… Database migrations
- âœ… Caching layer
- âœ… Comprehensive test suite

### In Progress / Planned
- ðŸ”„ Notifications system
- ðŸ”„ Workflow engine
- ðŸ”„ Versioning system
- ðŸ”„ Advanced permission schemes
- ðŸ”„ Performance optimizations

## Local Development Setup

### Prerequisites
- Rust toolchain
- Docker & Docker Compose
- PostgreSQL (via Docker)
- Redis (via Docker)

### Quick Start
1. Clone the repository
2. Run `docker-compose up -d` for database and Redis
3. Run migrations: `cargo run --bin run_migrations`
4. Start the application: `cargo run`
5. Access APIs at:
   - Public API: `http://rdatacore.docker/api/docs/`
   - Admin API: `http://rdatacore.docker/admin/api/docs/`

## Common Commands

### Development
```bash
# Format code
cargo fmt

# Lint code
cargo clippy

# Run unit tests
rdt test-unit

# Run integration tests
rdt test

# Apply database migrations
cargo run --bin run_migrations

# Hash passwords (for admin users)
cargo run --bin hash_password
```

### Docker Operations
```bash
# Start services
docker-compose up -d

# Stop services
docker-compose down

# View logs
docker-compose logs -f
```

## Architecture Notes

### Key Design Principles
- Separation of concerns between API, services, and data layers
- Dynamic entity system for maximum flexibility
- Comprehensive validation and error handling
- Scalable caching strategy
- Secure authentication and authorization

### Performance Considerations
- Efficient database queries with proper indexing
- Redis caching for frequently accessed data
- Connection pooling for database operations
- Async/await patterns for non-blocking operations

### Security Features
- JWT-based authentication
- API key management
- Role-based access control
- Input validation and sanitization
- Secure password hashing

